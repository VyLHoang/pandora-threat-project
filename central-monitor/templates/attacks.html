{% extends "base.html" %}

{% block title %}IDS Attacks - Pandora Admin{% endblock %}

{% block content %}
<div class="monitor-header">
    <div class="header-left">
        <h1>üõ°Ô∏è IDS Attack Dashboard</h1>
        <p>Intrusion Detection System - Attack Logs</p>
    </div>
    <div class="header-right">
        <div class="last-update">Last Update: {{ current_time }}</div>
        <form method="GET" style="display: inline;">
            <button type="submit" class="btn-refresh">üîÑ Refresh Now</button>
        </form>
    </div>
</div>

<!-- Filters -->
<div class="filters-section">
    <form method="GET" action="{{ url_for('attacks_page') }}">
        <div class="filter-group">
            <label for="severity">Severity:</label>
            <select name="severity" id="severity" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="critical" {% if request.args.get('severity') == 'critical' %}selected{% endif %}>Critical</option>
                <option value="high" {% if request.args.get('severity') == 'high' %}selected{% endif %}>High</option>
                <option value="medium" {% if request.args.get('severity') == 'medium' %}selected{% endif %}>Medium</option>
                <option value="low" {% if request.args.get('severity') == 'low' %}selected{% endif %}>Low</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="attack_type">Attack Type:</label>
            <select name="attack_type" id="attack_type" onchange="this.form.submit()">
                <option value="">All Types</option>
                <option value="port_scan" {% if request.args.get('attack_type') == 'port_scan' %}selected{% endif %}>Port Scan</option>
                <option value="syn_flood" {% if request.args.get('attack_type') == 'syn_flood' %}selected{% endif %}>SYN Flood</option>
                <option value="http_probe" {% if request.args.get('attack_type') == 'http_probe' %}selected{% endif %}>HTTP Probe</option>
                <option value="https_probe" {% if request.args.get('attack_type') == 'https_probe' %}selected{% endif %}>HTTPS Probe</option>
                <option value="telnet_probe" {% if request.args.get('attack_type') == 'telnet_probe' %}selected{% endif %}>Telnet Probe</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="limit">Show:</label>
            <select name="limit" id="limit" onchange="this.form.submit()">
                <option value="50" {% if request.args.get('limit', '50') == '50' %}selected{% endif %}>50 logs</option>
                <option value="100" {% if request.args.get('limit') == '100' %}selected{% endif %}>100 logs</option>
                <option value="200" {% if request.args.get('limit') == '200' %}selected{% endif %}>200 logs</option>
            </select>
        </div>

        <button type="submit" class="btn-filter">Apply Filters</button>
        <a href="{{ url_for('attacks_page') }}" class="btn-clear">Clear</a>
    </form>
</div>

<!-- Statistics -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">‚öîÔ∏è</div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.total_attacks }}</div>
            <div class="stat-label">Total Attacks</div>
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-icon">üåç</div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.unique_ips }}</div>
            <div class="stat-label">Unique IPs</div>
        </div>
    </div>

    <div class="stat-card critical">
        <div class="stat-icon">üî¥</div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.critical_attacks }}</div>
            <div class="stat-label">Critical</div>
        </div>
    </div>

    <div class="stat-card high">
        <div class="stat-icon">üü†</div>
        <div class="stat-info">
            <div class="stat-value">{{ stats.high_attacks }}</div>
            <div class="stat-label">High Risk</div>
        </div>
    </div>
</div>

<!-- Attack Logs Table -->
<div class="attacks-section">
    <h3>üìã Attack Logs ({{ attacks|length }} of {{ stats.total_attacks }})</h3>
    
    {% if attacks %}
    <div class="table-container">
        <table class="attacks-table">
            <thead>
                <tr>
                    <th>Time</th>
                    <th>Source IP</th>
                    <th>Location</th>
                    <th>Attack Type</th>
                    <th>Tool</th>
                    <th>Severity</th>
                    <th>Target Port</th>
                    <th>Packets</th>
                    <th>Confidence</th>
                </tr>
            </thead>
            <tbody>
                {% for attack in attacks %}
                <tr class="severity-{{ attack.severity }}">
                    <td class="timestamp">{{ attack.detected_at.strftime('%m/%d/%Y, %H:%M:%S') }}</td>
                    <td class="ip">{{ attack.source_ip }}:{{ attack.source_port }}</td>
                    <td class="location">{{ attack.city or 'Unknown' }}, {{ attack.country or 'Unknown' }}</td>
                    <td class="attack-type">
                        <span class="badge badge-{{ attack.attack_type }}">{{ attack.attack_type|upper }}</span>
                    </td>
                    <td class="tool">{{ attack.detected_tool or 'Unknown' }}</td>
                    <td class="severity">
                        <span class="badge-severity badge-{{ attack.severity }}">{{ attack.severity|upper }}</span>
                    </td>
                    <td class="port">{{ attack.target_port }}</td>
                    <td class="packets">{{ attack.packet_count }}</td>
                    <td class="confidence">{{ attack.confidence }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="no-data">
        <p>‚úÖ No attacks detected. System is secure!</p>
    </div>
    {% endif %}
</div>

<!-- Top Attackers -->
{% if stats.top_attackers %}
<div class="top-attackers-section">
    <h3>üéØ Top Attackers</h3>
    <div class="attackers-grid">
        {% for attacker in stats.top_attackers %}
        <div class="attacker-card">
            <div class="attacker-ip">{{ attacker.ip }}</div>
            <div class="attacker-count">{{ attacker.count }} attacks</div>
            <div class="attacker-location">{{ attacker.location }}</div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}
{% endblock %}

